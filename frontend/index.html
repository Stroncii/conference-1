<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
	<head>
		<meta content="text/html; charset=utf-8">

		<link rel="stylesheet" type="text/css" media="all" href="css/jquery.datetimepicker.css">
		<link rel="stylesheet" type="text/css" media="all" href="css/smoothness/jquery-ui-1.10.3.custom.css" rel="stylesheet">
		
		<link rel="stylesheet" type="text/css" href="css/style.css">
		
		<script type="text/javascript" src="script/jquery/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="script/jquery/jquery-ui-1.10.3.custom.js"></script>
		<script type="text/javascript" src="script/jquery/jquery.tmpl.js"></script>
		<script type="text/javascript" src="script/plugins/jquery.datetimepicker.js"></script>
		<script type="text/javascript" src="script/plugins/noty/packaged/jquery.noty.packaged.min.js"></script>
		
		<script type="text/javascript" src="script/main.js"></script> 
		<script type="text/javascript" src="script/dateFormat.js"></script>
		<script type="text/javascript" src="script/ajaxRequests.js"></script> 
		<script type="text/javascript" src="script/validators.js"></script> 	
		<script type="text/javascript" src="script/client.js"></script> 	
		<script type="text/javascript" src="script/reservation.js"></script> 	
		
		<script type="text/javascript">	
			$(document).ready(function() {

				//add element needed for dialog window creation
				$("<div id='dialog-confirm'></div>").appendTo("body");
				
				//place widgets on html page
				//(calendar, startDateTimePicker, endDateTimePicker)
				myNamespace.main.placeCalendar();
				myNamespace.main.placeStartDateTimePicker();
				myNamespace.main.placeDurationDateTimePicker();
				
				//bind DOM elements with event listeners
				$("#filter_entries").on("click", myNamespace.main.filterEntriesBoxOnClick);
				$("#name_input").on("blur", myNamespace.main.checkName);
				$("#password_input").on("blur", myNamespace.main.checkPassword);
				$("#start_date_time_input").on("blur", myNamespace.main.checkStartDateTime);
				$("#duration_input").on("blur", myNamespace.main.checkDuration);
				$("#repeat_check_box").on("click", myNamespace.main.repeatCheckBoxOnClick);
				$("#period_input").on("blur", myNamespace.main.checkPeriod);
				$("#reservations_number_input").on("blur", myNamespace.main.checkReservationsNumber);
				$("#reserve_button").on("click", myNamespace.main.reserveButtonOnClick);
				$("#reset_button").on("click", myNamespace.main.resetButtonOnClick);
				
				//hide "period" and "reservations number" input fields
				$("#repeat_check_box").parent().nextAll(".whole_input_div").css("display", "none");

				//show wait.gif, send loadData request
				$("#reservations_list_div").prepend("<img src='img/wait.gif' />");
				myNamespace.ajaxRequests.loadData(function(){	
					$("#reservations_list_div").empty();
					myNamespace.reservations.showList();
				});
			});
			
		</script>
		
		<script type="text/javascript">
			//auxiliary functions for reservation entries generation
			(function(namespace) {
				namespace.templates = {
					//show "cancel" button next to only unfinished reservations 
					checkCancelButtonVisibility: function(startDateTime) {
						return (startDateTime > new Date());
					},
					//show only today's reservations if it's needed
					checkReservationVisibility: function(startDateTime) {
						var dateFilter = $("#calendar_div").datepicker("getDate");
						if ($("#filter_entries")[0].checked) {
							
							return !(dateFilter.getDate() != startDateTime.getDate() ||
										dateFilter.getMonth() != startDateTime.getMonth() ||
										dateFilter.getFullYear() != startDateTime.getFullYear());
						}
						return true;
					}
				}
			})(myNamespace);
		</script>
			
		<script id="reservationsTmpl" type="text/x-jquery-tmpl">
			{{if myNamespace.templates.checkReservationVisibility(startDateTime)}}
				<div class="whole_reservation_div">
					<span class="title_elem">On</span><span class="text_elem">${startDateTime.shortDateFormat()}</span>
					<div class="separator"></div>
					<span class="title_elem">Duration</span><span class="text_elem">${startDateTime.shortTimeFormat()}-${endDateTime.shortTimeFormat()}</span>				
					{{if myNamespace.templates.checkCancelButtonVisibility(startDateTime)}}
						<input type="button", class="cancel_button" data-id="${id}" value="Cancel" />
						<span class="cancel_hint" data-id="${id}"></span>
					{{/if}}
					<div class="separator"></div>
					<span class="title_elem">Reserved by</span><span class="text_elem">${myNamespace.clients.getById(clientId)}</span>
				</div>
			{{/if}}	
		</script>
		
		<title>Conference room reservation</title>
	</head>
	
	<body>
		<div id="main_container_div">
			<div id="main_header_div">
				<h2>Conference room reservation</h2>
			</div>
			<div id="date_div">
				<div id="filter_checkbox_div">
					<input type="checkbox" id="filter_entries" name="filter_entries">Filter by date<br>
				</div>
			</div>	
			<div id="reservation_div">
				<form name="reservation_form" action="" method="POST">
					<div class="whole_input_div">
						<span class="title_elem">Enter your name:</span>
						<input id="name_input" name="name_input" class="input_elem"
							type="text" size="21" maxlength="20"> 
						<span id="name_hint" class="hint_elem"></span>
					</div>
					<div class="whole_input_div">
						<span class="title_elem">Enter your password:</span>
						<input id="password_input" name="password_input" class="input_elem"
							type="text" size="21" maxlength="20"> 
						<span id="password_hint" class="hint_elem"></span>
					</div>
					<div class="whole_input_div">
						<span class="title_elem">Enter the time, when you want to reserve this room (HH:MM):</span>
						<input id="start_date_time_input" name="start_date_time_input" class="input_elem"
							type="text" size="21" maxlength="5">
						<span id="start_date_time_hint" class="hint_elem"></span>
					</div>
					<div class="whole_input_div">
						<span class="title_elem">Enter duration of your reservation (HH:MM), min 1 hour, max 10 hours:</span>
						<input id="duration_input" name="duration_input" class="input_elem"
							type="text" size="21" maxlength="5"> 
						<span id="duration_hint" class="hint_elem"></span>
					</div>
						
					<p><input type="checkbox" id="repeat_check_box" name="repeat_check_box">Repeat reservation many times<br></p>
					
					<div class="whole_input_div">
						<span class="title_elem">Enter period (days) between reservations (max 14):</span>
						<input id="period_input" name="period_input" class="input_elem"
							type="text" size="20" maxlength="2"> 
						<span id="period_hint" class="hint_elem"></span>
					</div>
					<div class="whole_input_div">
						<span class="title_elem">Enter number of reservations (max 10):</span>
						<input id="reservations_number_input" name="reservations_number_input" class="input_elem"
							type="text" size="20" maxlength="2"> 
						<span id="reservations_number_hint" class="hint_elem"></span>
					</div>
					
					<p><input type="button" id="reserve_button" value="Reserve">
					<input type="button" id="reset_button" value="Reset"></p>
				</form>
			</div><!--reservation_div-->	
			<div id="reservations_list_header_div">
				<h3>Reservations list</h3>
			</div>
			<div id="reservations_list_div">
			</div>
		</div><!--main_container_div-->
	</body>
</html>